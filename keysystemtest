local Http = game:GetService("HttpService")
local hwid = game:GetService("RbxAnalyticsService"):GetClientId()
local KEY_FILE = "OmegaAuthKey.txt"
local key

--============================
-- Charger la key du fichier
--============================
if isfile and isfile(KEY_FILE) then
    key = readfile(KEY_FILE)
    print("üîê Key charg√©e automatiquement :", key)
end

-- Si aucune key enregistr√©e, demander via _G.Key
if not key or key == "" then
    if not _G.Key then
        return game.Players.LocalPlayer:Kick("‚ùå Aucune key fournie ! Utilise : _G.Key = \"ta_key\"")
    end
    key = _G.Key
    writefile(KEY_FILE, key)
    print("üíæ Key sauvegard√©e pour les prochaines fois !")
end

local req = syn and syn.request or http_request or request

local response = req({
    Url = "https://allyson-unprevailing-fae.ngrok-free.dev/auth", -- üî• change selon ton ngrok
    Method = "POST",
    Headers = {["Content-Type"] = "application/json"},
    Body = Http:JSONEncode({key = key, hwid = hwid})
})

local data = Http:JSONDecode(response.Body)

--============================
-- Gestion des erreurs avec messages sp√©cifiques
--============================
if not data.success then
    -- Supprime la key locale si invalide
    if isfile(KEY_FILE) then
        delfile(KEY_FILE)
    end

    -- Messages clairs pour toi
    local msg = data.msg or "‚ùå Key invalide ou erreur inconnue"
    if msg:find("Key invalide") then
        return game.Players.LocalPlayer:Kick("‚ùå Erreur : Key invalide")
    elseif msg:find("HWID") then
        return game.Players.LocalPlayer:Kick("‚ùå Erreur : HWID ne correspond pas")
    elseif msg:find("expir") then
        return game.Players.LocalPlayer:Kick("‚ùå Erreur : Key expir√©e")
    else
        return game.Players.LocalPlayer:Kick("‚ùå Erreur inconnue : "..msg)
    end
end

print("‚úî Auth Valid ‚Äî Acc√®s Autoris√©")

--============================
-- D√©compte du temps restant
--============================
if data.expires then
    local expiryDate = DateTime.fromIsoDate(data.expires)
    local now = DateTime.now()
    local remaining = expiryDate.UnixTimestamp - now.UnixTimestamp

    local days = math.floor(remaining / 86400)
    local hours = math.floor((remaining % 86400) / 3600)
    local minutes = math.floor((remaining % 3600) / 60)
    local seconds = remaining % 60

    print(string.format("‚è≥ Expire dans : %dd %dh %dm %ds", days, hours, minutes, seconds))
else
    print("‚ôæÔ∏è Lifetime")
end

--============================
-- Place ton script apr√®s ici
--============================
print("üëë Systeme d'auth Omega pr√™t !")
